<!DOCTYPE html>

<link rel=stylesheet type='text/css' href='style.css'></link>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>WebSockets Demo</title>
</head>
<body ng-app='app'>
  <div id="page-wrapper">
    <h1>WebDump</h1>

    <ul id="messages"></ul>
	<div ng-controller='demo' ng-init='initialize()'>
		<button ng-click='moveToTrash()'>Move to trash</button>
		<button ng-click='addMessage()'>Add message</button>

	    <h2>Messages</h2>
		<h3>
			<button ng-click='toggleTrashVisibility()'>
				{{trashVisible ? '-' : '+'}}
			</button>
			Trash ({{trash.length}} items)
			<button ng-click='restoreTrash()'>Restore</button>
			<button ng-click='emptyTrash()'>Empty trash</button>
		</h3>
			<message-list ng-show='trashVisible' list='trash'></message-list>
		<h3>Dumps</h3>
			<message-list list='messages' move-to-trash-fn='moveToTrash'></message-list>

	</div>

</body>
</html>

<script src='js/jquery-2.2.1.min.js'></script>
<script src='js/angular.min.js'></script>


<script type="text/javascript">

angular.module('app', [])
.controller('demo',[ '$scope', function($scope) {
	$scope.messages = [];
	$scope.trash = [];
	$scope.id = 1;
	$scope.trashVisible = false;

	$scope.addMessage = function() {
	    var message = { id: $scope.id, content: "Message #" + $scope.id++ };
		$scope.messages.push(message);
	}
	$scope.moveToTrash = function(message) {
		if(message == undefined) {
			// move all to trash
			$.merge($scope.trash,$scope.messages);
			$scope.messages = [];
		}
		else {
			// only move that message to trash
			$.merge($scope.trash,message);
			var index = $scope.messages.indexOf(message);
			$scope.messages.splice(index,1)
		}
	}
	$scope.toggleTrashVisibility = function() {
		$scope.trashVisible = !$scope.trashVisible;
	}
	$scope.emptyTrash = function() {
		$scope.trash = [];
	}
	$scope.restoreTrash = function() {
		$scope.messages = $scope.trash.concat($scope.messages);
		$scope.emptyTrash();
	}

	$scope.initialize = function() {
		$scope.addMessage();
		$scope.addMessage();
		$scope.addMessage();
		$scope.addMessage();
		$scope.moveToTrash();
		$scope.addMessage();	
	}
	
} ] )
// message-list template directive
.directive('messageList', function() {
	var tpl = `
	<div ng-repeat='model in list'>
			<div id='mess{{model.id}}'>
				<button ng-click='moveToTrashFn(model)'>To Trash</button>
				{{model.content}}
			</div>
	<\div>
	`
	return {
		restrict: 'E',
		scope: { list : '=', moveToTrashFn : '=' },
		template: tpl
		// link: function(scope, element, attrs) {
	 //        $compile(element.contents())(scope.$new());
	    	}
	}
);


</script>